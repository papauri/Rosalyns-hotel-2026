<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Key Testing Tool - Rosalyn's Hotel Booking API</title>
    <style>
        /* ===== BASE STYLES ===== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ===== SECTIONS ===== */
        .section {
            padding: 25px 30px;
            border-bottom: 1px solid #eee;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #3498db;
            border-radius: 2px;
        }

        /* ===== FORM ELEMENTS ===== */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
            color: #555;
        }

        label .required {
            color: #e74c3c;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        input::placeholder {
            color: #aaa;
        }

        .help-text {
            font-size: 12px;
            color: #777;
            margin-top: 4px;
        }

        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #229954;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-loading {
            position: relative;
        }

        .btn-loading::after {
            content: '';
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== RESPONSE AREA ===== */
        .response-area {
            background: #f8f9fa;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 15px;
        }

        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: #e9ecef;
            border-bottom: 1px solid #dee2e6;
        }

        .response-status {
            font-weight: 600;
            font-size: 13px;
        }

        .response-status.success {
            color: #27ae60;
        }

        .response-status.error {
            color: #e74c3c;
        }

        .response-time {
            font-size: 12px;
            color: #666;
        }

        .response-body {
            padding: 15px;
            max-height: 400px;
            overflow: auto;
        }

        .response-body pre {
            margin: 0;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.5;
            color: #333;
        }

        /* ===== GRID LAYOUTS ===== */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .grid-2,
            .grid-3 {
                grid-template-columns: 1fr;
            }
        }

        /* ===== ALERT BOXES ===== */
        .alert {
            padding: 12px 15px;
            border-radius: 4px;
            font-size: 13px;
            margin-bottom: 15px;
        }

        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }

        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 30px;
            color: #999;
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            margin-bottom: 10px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üîë API Key Testing Tool</h1>
            <p>Rosalyn's Hotel Booking API - Test your API key integration</p>
        </div>

        <!-- CONFIGURATION SECTION -->
        <div class="section">
            <h2 class="section-title">API Configuration</h2>
            
            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è Info:</strong> Enter your API credentials below. These are only used in your browser and are not stored anywhere.
            </div>

            <div class="form-group">
                <label for="apiBaseUrl">API Base URL <span class="required">*</span></label>
                <input type="text" id="apiBaseUrl" placeholder="https://your-domain.com" value="">
                <div class="help-text">The base URL of your hotel website (without /api/)</div>
            </div>

            <div class="form-group">
                <label for="apiKey">API Key <span class="required">*</span></label>
                <input type="text" id="apiKey" placeholder="Enter your test API key here">
                <div class="help-text">Your secret API key for authentication (sent in X-API-Key header)</div>
            </div>
        </div>

        <!-- AVAILABILITY TEST SECTION -->
        <div class="section">
            <h2 class="section-title">Test Availability Check</h2>
            <p style="margin-bottom: 15px; color: #666; font-size: 14px;">
                Check if a room is available for specific dates using <code>GET /api/availability</code>
            </p>

            <div class="grid-3">
                <div class="form-group">
                    <label for="availRoomId">Room ID <span class="required">*</span></label>
                    <input type="number" id="availRoomId" placeholder="1" value="1">
                    <div class="help-text">ID of the room to check</div>
                </div>

                <div class="form-group">
                    <label for="availCheckIn">Check-in Date <span class="required">*</span></label>
                    <input type="date" id="availCheckIn">
                    <div class="help-text">Format: YYYY-MM-DD</div>
                </div>

                <div class="form-group">
                    <label for="availCheckOut">Check-out Date <span class="required">*</span></label>
                    <input type="date" id="availCheckOut">
                    <div class="help-text">Format: YYYY-MM-DD</div>
                </div>
            </div>

            <div class="form-group">
                <button id="testAvailabilityBtn" class="btn btn-primary">
                    <span>üîç</span> Check Availability
                </button>
            </div>

            <!-- Availability Response -->
            <div id="availabilityResponse" class="response-area" style="display: none;">
                <div class="response-header">
                    <span id="availabilityStatus" class="response-status"></span>
                    <span id="availabilityTime" class="response-time"></span>
                </div>
                <div class="response-body">
                    <pre id="availabilityBody"></pre>
                </div>
            </div>
        </div>

        <!-- BOOKING TEST SECTION -->
        <div class="section">
            <h2 class="section-title">Test Booking Creation</h2>
            <p style="margin-bottom: 15px; color: #666; font-size: 14px;">
                Create a new booking using <code>POST /api/bookings</code>
            </p>

            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Warning:</strong> This will create a real booking in the system. Use test dates and data only.
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="bookRoomId">Room ID <span class="required">*</span></label>
                    <input type="number" id="bookRoomId" placeholder="1" value="1">
                </div>

                <div class="form-group">
                    <label for="bookGuestName">Guest Name <span class="required">*</span></label>
                    <input type="text" id="bookGuestName" placeholder="John Doe" value="Test Customer">
                </div>

                <div class="form-group">
                    <label for="bookGuestEmail">Guest Email <span class="required">*</span></label>
                    <input type="email" id="bookGuestEmail" placeholder="john@example.com" value="test@example.com">
                </div>

                <div class="form-group">
                    <label for="bookGuestPhone">Guest Phone <span class="required">*</span></label>
                    <input type="tel" id="bookGuestPhone" placeholder="+265123456789" value="+265123456789">
                </div>

                <div class="form-group">
                    <label for="bookGuestCountry">Guest Country</label>
                    <input type="text" id="bookGuestCountry" placeholder="Malawi" value="Malawi">
                </div>

                <div class="form-group">
                    <label for="bookGuestAddress">Guest Address</label>
                    <input type="text" id="bookGuestAddress" placeholder="123 Street">
                </div>

                <div class="form-group">
                    <label for="bookGuests">Number of Guests <span class="required">*</span></label>
                    <input type="number" id="bookGuests" placeholder="2" value="2" min="1">
                </div>

                <div class="form-group">
                    <label for="bookChildGuests">Child Guests</label>
                    <input type="number" id="bookChildGuests" placeholder="0" value="0" min="0">
                </div>

                <div class="form-group">
                    <label for="bookOccupancy">Occupancy Type</label>
                    <select id="bookOccupancy">
                        <option value="double" selected>Double</option>
                        <option value="single">Single</option>
                        <option value="triple">Triple</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="bookCheckIn">Check-in Date <span class="required">*</span></label>
                    <input type="date" id="bookCheckIn">
                </div>

                <div class="form-group">
                    <label for="bookCheckOut">Check-out Date <span class="required">*</span></label>
                    <input type="date" id="bookCheckOut">
                </div>
            </div>

            <div class="form-group">
                <label for="bookSpecialRequests">Special Requests</label>
                <textarea id="bookSpecialRequests" rows="2" placeholder="Any special requests...">Test booking via API</textarea>
            </div>

            <div class="form-group">
                <button id="testBookingBtn" class="btn btn-success">
                    <span>üìù</span> Create Booking
                </button>
            </div>

            <!-- Booking Response -->
            <div id="bookingResponse" class="response-area" style="display: none;">
                <div class="response-header">
                    <span id="bookingStatus" class="response-status"></span>
                    <span id="bookingTime" class="response-time"></span>
                </div>
                <div class="response-body">
                    <pre id="bookingBody"></pre>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="section" style="background: #f8f9fa; text-align: center; font-size: 13px; color: #666;">
            <p>üîí Your API key is only used in your browser for testing. It is never sent to any third-party server.</p>
        </div>
    </div>

    <script>
        // ===== HELPER FUNCTIONS =====
        
        /**
         * Get configuration values from the form
         */
        function getConfig() {
            return {
                baseUrl: document.getElementById('apiBaseUrl').value.trim(),
                apiKey: document.getElementById('apiKey').value.trim()
            };
        }

        /**
         * Validate configuration before making API calls
         */
        function validateConfig() {
            const config = getConfig();
            
            if (!config.baseUrl) {
                showError('availabilityResponse', 'Please enter API Base URL');
                return null;
            }
            
            if (!config.apiKey) {
                showError('availabilityResponse', 'Please enter your API Key');
                return null;
            }
            
            // Remove trailing slash from base URL
            config.baseUrl = config.baseUrl.replace(/\/$/, '');
            
            return config;
        }

        /**
         * Format JSON for display with syntax highlighting
         */
        function formatJSON(obj) {
            return JSON.stringify(obj, null, 2);
        }

        /**
         * Show error response in a response area
         */
        function showError(responseId, message) {
            const responseArea = document.getElementById(responseId);
            const statusEl = document.getElementById(responseId.replace('Response', 'Status'));
            const bodyEl = document.getElementById(responseId.replace('Response', 'Body'));
            
            responseArea.style.display = 'block';
            statusEl.className = 'response-status error';
            statusEl.textContent = 'Error';
            bodyEl.textContent = message;
        }

        /**
         * Show API response in a response area
         */
        function showResponse(responseId, statusCode, data, duration) {
            const responseArea = document.getElementById(responseId);
            const statusEl = document.getElementById(responseId.replace('Response', 'Status'));
            const timeEl = document.getElementById(responseId.replace('Response', 'Time'));
            const bodyEl = document.getElementById(responseId.replace('Response', 'Body'));
            
            responseArea.style.display = 'block';
            
            // Set status class and text based on status code
            if (statusCode >= 200 && statusCode < 300) {
                statusEl.className = 'response-status success';
                statusEl.textContent = `Success (${statusCode})`;
            } else {
                statusEl.className = 'response-status error';
                statusEl.textContent = `Error (${statusCode})`;
            }
            
            timeEl.textContent = `${duration}ms`;
            bodyEl.textContent = formatJSON(data);
        }

        /**
         * Make an API request with proper headers
         */
        async function makeRequest(endpoint, method = 'GET', body = null) {
            const config = validateConfig();
            if (!config) return null;
            
            const url = `${config.baseUrl}/api/${endpoint}`;
            const headers = {
                'Content-Type': 'application/json',
                'X-API-Key': config.apiKey
            };
            
            const options = {
                method: method,
                headers: headers
            };
            
            if (body) {
                options.body = JSON.stringify(body);
            }
            
            const startTime = performance.now();
            
            try {
                const response = await fetch(url, options);
                const duration = Math.round(performance.now() - startTime);
                
                let data;
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    data = await response.text();
                }
                
                return {
                    statusCode: response.status,
                    data: data,
                    duration: duration
                };
            } catch (error) {
                const duration = Math.round(performance.now() - startTime);
                return {
                    statusCode: 0,
                    data: {
                        error: 'Network error: ' + error.message,
                        message: 'Could not connect to the API. Check your base URL and network connection.'
                    },
                    duration: duration
                };
            }
        }

        /**
         * Set button loading state
         */
        function setButtonLoading(btnId, loading) {
            const btn = document.getElementById(btnId);
            if (loading) {
                btn.disabled = true;
                btn.classList.add('btn-loading');
            } else {
                btn.disabled = false;
                btn.classList.remove('btn-loading');
            }
        }

        // ===== AVAILABILITY TEST =====
        
        /**
         * Test the availability endpoint
         * GET /api/availability?room_id={id}&check_in={date}&check_out={date}
         */
        async function testAvailability() {
            const roomId = document.getElementById('availRoomId').value;
            const checkIn = document.getElementById('availCheckIn').value;
            const checkOut = document.getElementById('availCheckOut').value;
            
            // Validate required fields
            if (!roomId || !checkIn || !checkOut) {
                showError('availabilityResponse', 'Please fill in all required fields: Room ID, Check-in Date, and Check-out Date');
                return;
            }
            
            setButtonLoading('testAvailabilityBtn', true);
            
            // Build query parameters
            const params = new URLSearchParams({
                room_id: roomId,
                check_in: checkIn,
                check_out: checkOut
            });
            
            const result = await makeRequest(`availability?${params}`, 'GET');
            
            setButtonLoading('testAvailabilityBtn', false);
            
            if (result) {
                showResponse('availabilityResponse', result.statusCode, result.data, result.duration);
            }
        }

        // ===== BOOKING TEST =====
        
        /**
         * Test the booking creation endpoint
         * POST /api/bookings
         */
        async function testBooking() {
            // Gather all form values
            const payload = {
                room_id: parseInt(document.getElementById('bookRoomId').value) || 0,
                guest_name: document.getElementById('bookGuestName').value.trim(),
                guest_email: document.getElementById('bookGuestEmail').value.trim(),
                guest_phone: document.getElementById('bookGuestPhone').value.trim(),
                guest_country: document.getElementById('bookGuestCountry').value.trim(),
                guest_address: document.getElementById('bookGuestAddress').value.trim(),
                number_of_guests: parseInt(document.getElementById('bookGuests').value) || 1,
                child_guests: parseInt(document.getElementById('bookChildGuests').value) || 0,
                occupancy_type: document.getElementById('bookOccupancy').value,
                check_in_date: document.getElementById('bookCheckIn').value,
                check_out_date: document.getElementById('bookCheckOut').value,
                special_requests: document.getElementById('bookSpecialRequests').value.trim()
            };
            
            // Validate required fields
            const requiredFields = ['room_id', 'guest_name', 'guest_email', 'guest_phone', 'number_of_guests', 'check_in_date', 'check_out_date'];
            const missingFields = requiredFields.filter(field => {
                const value = payload[field];
                return value === undefined || value === null || value === '';
            });
            
            if (missingFields.length > 0) {
                showError('bookingResponse', 'Missing required fields: ' + missingFields.join(', '));
                return;
            }
            
            setButtonLoading('testBookingBtn', true);
            
            const result = await makeRequest('bookings', 'POST', payload);
            
            setButtonLoading('testBookingBtn', false);
            
            if (result) {
                showResponse('bookingResponse', result.statusCode, result.data, result.duration);
            }
        }

        // ===== INITIALIZATION =====
        
        // Set default dates (tomorrow and day after)
        function setDefaultDates() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const dayAfter = new Date();
            dayAfter.setDate(dayAfter.getDate() + 2);
            
            const formatDate = (date) => date.toISOString().split('T')[0];
            
            document.getElementById('availCheckIn').value = formatDate(tomorrow);
            document.getElementById('availCheckOut').value = formatDate(dayAfter);
            document.getElementById('bookCheckIn').value = formatDate(tomorrow);
            document.getElementById('bookCheckOut').value = formatDate(dayAfter);
        }

        // Set up event listeners when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Set default dates
            setDefaultDates();
            
            // Attach event listeners
            document.getElementById('testAvailabilityBtn').addEventListener('click', testAvailability);
            document.getElementById('testBookingBtn').addEventListener('click', testBooking);
        });
    </script>
</body>
</html>
